/*https://github.com/FinelySliced/leanModal.js*/
(function($){
	$.fn.extend({
		leanModal:function(options){
			var defaults = {
				top:50,
				overlay:0.5,
				closeButton:null,
				href:null,
                                mode:'click',
				closeCallback: function(){}
			};
			if( document.getElementById("lean_overlay")===null)
                        {
			var overlay = $("<div id='lean_overlay'></div>");
			$("body").append(overlay);
                        }
			console.log("leanModal", this);
			options = $.extend(defaults,options);
			
			return this.each(function(){
				var o=options;
                                 var modal_id
                                 
                                 console.log("option mode",o.mode);
                                   
                                if (o.mode=="auto")
                                {
                                     modal_id="#"+this.id;
                                     console.log("mode auto",modal_id);
                                    process_modal(modal_id,o)
                                }
                                else
                                     if (o.mode=="close")
                                {
                                     modal_id="#"+this.id;
                                     console.log("mode close",modal_id);
                                     close_modal(modal_id)
                                }
                                else
                                if (o.mode=="click")
                                {
                                    
				$(this).click(function(e){
					if (o.href == null){
						 modal_id=$(this).attr("href");
					}else{
						 modal_id=o.href;
					}
                                 
                                    
                                    console.log("mode click",modal_id);     
                                    process_modal(modal_id,o);
                                         e.preventDefault()     
                                })
                            }
                                                  
		});
		/* DO PROCESS POPUP*/
                function process_modal(modal_id,o)
                {
                       console.log("process_modal",process_modal);
                       open_modal(modal_id,o)
//                       console.log("*********** login_checked",login_checked);
                    
                       for_close_modal(modal_id,o)
                                 
                }
                
                // PREPARE CLOSURE
                function for_close_modal(modal_id,o)
                {
                    $("#lean_overlay").click(function(){
                     
//                        alert("for_close_modal2")
                            console.log("for_close_modal");
					close_modal(modal_id)
				});
                                
                                
                    $(o.closeButton).click(function(){
                         console.log("o.closeButton).click");
                            close_modal(modal_id)
                    });
                }
                
                // EXECUTE CLOSURE
		function close_modal(modal_id){
                    console.log("close_modal1", modal_id)
			$("#lean_overlay").fadeOut(200);
			$(modal_id).css({
				"display":"none"
			});
                        $(modal_id).attr("current_popup",  false);
			defaults.closeCallback.call();
		}
              
                // OPEN POPUP
                function open_modal(modal_id,o)
                {
                     console.log("open_modal1", modal_id)
                    var modal_height=$(modal_id).outerHeight();
				var modal_width=$(modal_id).outerWidth();
				
				$("#lean_overlay").css({
					"display":"block",
					opacity:0
				});
				$("#lean_overlay").fadeTo(200,o.overlay);
				$(modal_id).css({
					"display":"block",
					"position":"fixed",
					"opacity":0,
					"z-index":6900,
					"left":50+"%",
					"margin-left":-(modal_width/2)+"px",
					"top":o.top+"%",
					"margin-top":-(modal_height/2)+"px"
				});
                                $(modal_id).attr("current_popup",true)
                                console.log(modal_id,"current_popup", $(modal_id).prop("current_popup"));
				$(modal_id).fadeTo(200,1);
				$('html, body').animate({ scrollTop: 0 }, 200);
                }
                
	}
        /*
,
close_modal:function()
                        {
                        console.log("close_modal2", this);
                        $("#lean_overlay").fadeOut(200);
			$(this).css({ "display":"none"});
                        }*/

})})(jQuery);

console.log("leanModal loaded");